{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kermar709\\\\Desktop\\\\parfumvilag\\\\Parfumvilag\\\\Parfumvilag_2.0\\\\frontend\\\\src\\\\pages\\\\Profile.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, useContext } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { getUser, updateUser } from '../services/userService';\nimport { AuthContext } from '../App';\nimport placeholderImage from '../assets/placeholder.png'; // <<< HELYES IMPORT ÚTVONAL LEGYEN!\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Profile = () => {\n  _s();\n  const {\n    isLoggedIn,\n    user: contextUser,\n    login: contextLogin,\n    logout: contextLogout\n  } = useContext(AuthContext);\n  const navigate = useNavigate();\n\n  // --- State Definitions ---\n  const [user, setUser] = useState(contextUser || null);\n  const [loading, setLoading] = useState(!contextUser);\n  const [updateLoading, setUpdateLoading] = useState(false);\n  const [editing, setEditing] = useState(false);\n  const [error, setError] = useState(''); // General/Fetch error\n  const [updateError, setUpdateError] = useState(''); // Update specific error\n  const [validationErrors, setValidationErrors] = useState({});\n  const [updateSuccess, setUpdateSuccess] = useState('');\n\n  // Form state\n  const [newName, setNewName] = useState('');\n  const [newEmail, setNewEmail] = useState('');\n  const [newPassword, setNewPassword] = useState('');\n  const [phoneNumber, setPhoneNumber] = useState('');\n  const [imageUrl, setImageUrl] = useState('');\n  const [profileImage, setProfileImage] = useState('');\n\n  // --- Initialize Form ---\n  const initializeForm = useCallback(userData => {\n    if (!userData) return;\n    console.log(\"[initializeForm] Initializing with:\", userData.name, userData.profile_picture_url);\n    setNewName(userData.name || '');\n    setNewEmail(userData.email || '');\n    setPhoneNumber(userData.phone || '');\n    const currentImageUrl = userData.profile_picture_url || '';\n    setImageUrl(currentImageUrl);\n    setProfileImage(currentImageUrl);\n    setNewPassword('');\n    setValidationErrors({});\n    setUpdateError('');\n    setUpdateSuccess('');\n  }, []);\n\n  // --- Fetch User ---\n  const fetchUser = useCallback(async (force = false) => {\n    if (!isLoggedIn) return null;\n    if (loading && !force) return user;\n    console.log(`[fetchUser] Attempting fetch... Force: ${force}`);\n    if (!force) setLoading(true); // Only set initial loading if not forced\n    setError('');\n    try {\n      const userData = await getUser();\n      if (!userData) throw new Error(\"Nem érkeztek felhasználói adatok.\");\n      console.log(\"[fetchUser] Data received:\", userData.name, userData.profile_picture_url);\n\n      // Update states\n      setUser(userData);\n      contextLogin(userData, localStorage.getItem('token'));\n      initializeForm(userData); // Always initialize form after successful fetch\n\n      if (!force) setLoading(false); // Stop initial loading\n      return userData;\n    } catch (err) {\n      var _err$response;\n      console.error(\"[fetchUser] Error:\", err);\n      setError(err.message || 'Profil betöltési hiba.');\n      setUser(null);\n      if (err.message.includes('hitelesít') || ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401) {\n        contextLogout();\n        navigate('/bejelentkezes');\n      }\n      if (!force) setLoading(false); // Stop initial loading on error\n      return null;\n    }\n  }, [isLoggedIn, loading, user, editing, contextLogin, contextLogout, navigate, initializeForm]); // Add user, editing\n\n  // --- Initial Load Effect ---\n  useEffect(() => {\n    if (isLoggedIn && !user && !loading) {\n      // Fetch only if logged in, no user, and not already loading\n      fetchUser();\n    } else if (isLoggedIn && user && !editing) {\n      // If user exists and not editing, ensure form is synced\n      initializeForm(user);\n    } else if (!isLoggedIn) {\n      // Handle logged out state if necessary (e.g., redirect)\n    }\n  }, [isLoggedIn, user, editing, loading, fetchUser, initializeForm]); // Dependencies\n\n  // --- Validation ---\n  const validateForm = useCallback(() => {\n    // ... (validation logic) ...\n    const errors = {};\n    if (!newName.trim()) errors.name = 'Név megadása kötelező!';\n    if (!newEmail.trim()) {\n      errors.email = 'Email cím megadása kötelező!';\n    } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(newEmail)) {\n      errors.email = 'Érvénytelen email cím formátum!';\n    }\n    if (newPassword && newPassword.length < 6) {\n      errors.password = 'Jelszó min. 6 karakter!';\n    }\n    if (phoneNumber && phoneNumber.trim() && !/^\\+?[0-9\\s-()]{7,}$/.test(phoneNumber)) {\n      errors.phoneNumber = 'Érvénytelen telefonszám!';\n    }\n    const trimmedImageUrl = imageUrl.trim();\n    if (trimmedImageUrl && !/^https?:\\/\\/.+\\..+/i.test(trimmedImageUrl)) {\n      errors.imageUrl = 'Érvénytelen URL (http(s)://...)!';\n    }\n    setValidationErrors(errors);\n    return Object.keys(errors).length === 0;\n  }, [newName, newEmail, newPassword, phoneNumber, imageUrl]);\n\n  // --- Handle Update (Focus on stopping loading) ---\n  const handleEdit = async e => {\n    e.preventDefault();\n    console.log(\"[handleEdit] Submit triggered.\");\n    if (!validateForm()) {\n      console.log(\"[handleEdit] Validation failed.\");\n      return;\n    }\n    setUpdateLoading(true); // <<< START Loading\n    console.log(\"[handleEdit] updateLoading set to true.\");\n    setUpdateError('');\n    setUpdateSuccess('');\n    const dataToUpdate = {\n      name: newName.trim(),\n      email: newEmail.trim(),\n      phone: phoneNumber.trim() || null,\n      profile_picture_url: imageUrl.trim() || null // Use DB name\n    };\n    if (newPassword.trim()) {\n      dataToUpdate.password = newPassword.trim();\n    }\n    try {\n      console.log(\"[handleEdit] Calling updateUser with:\", dataToUpdate);\n      await updateUser(dataToUpdate); // Call API\n      console.log(\"[handleEdit] updateUser call presumed successful.\");\n\n      // --- Force Re-fetch ---\n      console.log(\"[handleEdit] Forcing user re-fetch...\");\n      const freshUserData = await fetchUser(true); // force=true\n\n      if (freshUserData) {\n        console.log(\"[handleEdit] Re-fetch successful.\");\n        setEditing(false); // Exit edit mode ONLY after success\n        setUpdateSuccess('Adatok sikeresen frissítve!');\n        // Form is initialized by fetchUser -> initializeForm\n        setTimeout(() => setUpdateSuccess(''), 4000);\n      } else {\n        console.error(\"[handleEdit] Re-fetch FAILED after successful update!\");\n        // Don't exit editing mode, show error\n        setUpdateError(\"Hiba történt az adatok frissítésekor a felületen. Próbáld újra menteni, vagy frissítsd az oldalt.\");\n      }\n    } catch (updateOrFetchErr) {\n      console.error(\"[handleEdit] Error during update/re-fetch process:\", updateOrFetchErr);\n      setUpdateError(updateOrFetchErr.message || 'Hiba történt a mentés során.');\n    } finally {\n      // --- **KRITIKUS** ---\n      console.log(\"[handleEdit] Entering finally block...\");\n      setUpdateLoading(false); // <<< STOP Loading GUARANTEED\n      console.log(\"[handleEdit] updateLoading set to false.\");\n    }\n  };\n\n  // --- Logout ---\n  const handleLogout = () => {/* ... */};\n  // --- Cancel Edit ---\n  const handleCancelEdit = () => {/* ... (uses initializeForm) ... */};\n\n  // --- Render Logic ---\n  if (loading) {/* ... Spinner ... */}\n  if (!user) {/* ... Error/Login prompt ... */}\n\n  // --- Main Profile Render ---\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container py-5\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"profile-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"profile-title mb-4\",\n        children: \"Profil\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 17\n      }, this), updateSuccess && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"alert alert-success\",\n        children: updateSuccess\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 35\n      }, this), updateError && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"alert alert-danger\",\n        children: updateError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 33\n      }, this), error && !editing && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"alert alert-danger\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 39\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"profile-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"profile-image-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            // profileImage state holds the URL for display\n            src: profileImage || placeholderImage // Use local fallback\n            ,\n            alt: `${user.name} profilképe`,\n            className: \"profile-image\",\n            // Force re-render\n            onError: e => {\n              console.warn(\"Image onError triggered for src:\", e.target.src);\n              e.target.onerror = null;\n              e.target.src = placeholderImage; // Fallback to local image\n            }\n          }, profileImage, false, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 25\n          }, this), editing && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 5\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"profile-subtitle mb-3\",\n          children: \"Felhaszn\\xE1l\\xF3i adatok\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 21\n        }, this), !editing ?\n        /*#__PURE__*/\n        // --- Display Mode ---\n        _jsxDEV(\"div\", {\n          className: \"profile-details\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"N\\xE9v:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 12\n            }, this), \" \", user.name]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Email:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 219,\n              columnNumber: 12\n            }, this), \" \", user.email]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Telefonsz\\xE1m:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 12\n            }, this), \" \", user.phone || 'Nincs megadva']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Regisztr\\xE1ci\\xF3:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 12\n            }, this), \" \", user.created_at ? new Date(user.created_at).toLocaleDateString('hu-HU') : 'Ismeretlen']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"profile-actions mt-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-outline-primary\",\n              onClick: () => setEditing(true),\n              disabled: updateLoading,\n              children: \"Adatok szerkeszt\\xE9se\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-outline-danger ms-2\",\n              onClick: handleLogout,\n              disabled: updateLoading,\n              children: \"Kil\\xE9p\\xE9s\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 5\n        }, this) :\n        /*#__PURE__*/\n        // --- Editing Mode ---\n        _jsxDEV(\"form\", {\n          id: \"profileForm\",\n          onSubmit: handleEdit,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"editName\",\n              className: \"form-label\",\n              children: \"N\\xE9v\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 232,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              className: `form-control ${validationErrors.name ? 'is-invalid' : ''}`,\n              id: \"editName\",\n              value: newName,\n              onChange: e => setNewName(e.target.value),\n              required: true,\n              disabled: updateLoading\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 233,\n              columnNumber: 13\n            }, this), validationErrors.name && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invalid-feedback\",\n              children: validationErrors.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 39\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"editEmail\",\n              className: \"form-label\",\n              children: \"Email c\\xEDm\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 238,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"email\",\n              className: `form-control ${validationErrors.email ? 'is-invalid' : ''}`,\n              id: \"editEmail\",\n              value: newEmail,\n              onChange: e => setNewEmail(e.target.value),\n              required: true,\n              disabled: updateLoading\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 13\n            }, this), validationErrors.email && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invalid-feedback\",\n              children: validationErrors.email\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 240,\n              columnNumber: 40\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"editPhoneNumber\",\n              className: \"form-label\",\n              children: \"Telefonsz\\xE1m\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"tel\",\n              className: `form-control ${validationErrors.phoneNumber ? 'is-invalid' : ''}`,\n              id: \"editPhoneNumber\",\n              value: phoneNumber,\n              onChange: e => setPhoneNumber(e.target.value),\n              placeholder: \"Opcion\\xE1lis\",\n              disabled: updateLoading\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 13\n            }, this), validationErrors.phoneNumber && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invalid-feedback\",\n              children: validationErrors.phoneNumber\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 46\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"profileImageUrl\",\n              className: \"form-label\",\n              children: \"Profilk\\xE9p URL\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              className: `form-control ${validationErrors.imageUrl ? 'is-invalid' : ''}`,\n              id: \"profileImageUrl\",\n              value: imageUrl,\n              onChange: e => {\n                setImageUrl(e.target.value);\n                setProfileImage(e.target.value);\n              },\n              placeholder: \"K\\xE9p URL-je (pl. https://...)\",\n              disabled: updateLoading\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 13\n            }, this), validationErrors.imageUrl && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invalid-feedback\",\n              children: validationErrors.imageUrl\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 44\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"editPassword\",\n              className: \"form-label\",\n              children: \"\\xDAj jelsz\\xF3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"password\",\n              className: `form-control ${validationErrors.password ? 'is-invalid' : ''}`,\n              id: \"editPassword\",\n              value: newPassword,\n              onChange: e => setNewPassword(e.target.value),\n              placeholder: \"\\xDCresen hagyva nem v\\xE1ltozik\",\n              disabled: updateLoading\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 257,\n              columnNumber: 13\n            }, this), validationErrors.password && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invalid-feedback\",\n              children: validationErrors.password\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 43\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"profile-actions mt-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"btn btn-primary\",\n              disabled: updateLoading,\n              children: updateLoading ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"spinner-border spinner-border-sm me-2\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 264,\n                  columnNumber: 36\n                }, this), \"Ment\\xE9s...\"]\n              }, void 0, true) : 'Mentés'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"btn btn-outline-secondary ms-2\",\n              onClick: handleCancelEdit,\n              disabled: updateLoading,\n              children: \"M\\xE9gse\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 262,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 5\n        }, this), \")}\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 182,\n    columnNumber: 9\n  }, this);\n};\n_s(Profile, \"fr978LIaNh4MUkivUxGfNBwUFx0=\", false, function () {\n  return [useNavigate];\n});\n_c = Profile;\nexport default Profile;\nvar _c;\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useContext","useNavigate","getUser","updateUser","AuthContext","placeholderImage","jsxDEV","_jsxDEV","Fragment","_Fragment","Profile","_s","isLoggedIn","user","contextUser","login","contextLogin","logout","contextLogout","navigate","setUser","loading","setLoading","updateLoading","setUpdateLoading","editing","setEditing","error","setError","updateError","setUpdateError","validationErrors","setValidationErrors","updateSuccess","setUpdateSuccess","newName","setNewName","newEmail","setNewEmail","newPassword","setNewPassword","phoneNumber","setPhoneNumber","imageUrl","setImageUrl","profileImage","setProfileImage","initializeForm","userData","console","log","name","profile_picture_url","email","phone","currentImageUrl","fetchUser","force","Error","localStorage","getItem","err","_err$response","message","includes","response","status","validateForm","errors","trim","test","length","password","trimmedImageUrl","Object","keys","handleEdit","e","preventDefault","dataToUpdate","freshUserData","setTimeout","updateOrFetchErr","handleLogout","handleCancelEdit","className","children","fileName","_jsxFileName","lineNumber","columnNumber","src","alt","onError","warn","target","onerror","created_at","Date","toLocaleDateString","onClick","disabled","id","onSubmit","htmlFor","type","value","onChange","required","placeholder","_c","$RefreshReg$"],"sources":["C:/Users/kermar709/Desktop/parfumvilag/Parfumvilag/Parfumvilag_2.0/frontend/src/pages/Profile.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useContext } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { getUser, updateUser } from '../services/userService';\r\nimport { AuthContext } from '../App';\r\nimport placeholderImage from '../assets/placeholder.png'; // <<< HELYES IMPORT ÚTVONAL LEGYEN!\r\n\r\nconst Profile = () => {\r\n    const { isLoggedIn, user: contextUser, login: contextLogin, logout: contextLogout } = useContext(AuthContext);\r\n    const navigate = useNavigate();\r\n\r\n    // --- State Definitions ---\r\n    const [user, setUser] = useState(contextUser || null);\r\n    const [loading, setLoading] = useState(!contextUser);\r\n    const [updateLoading, setUpdateLoading] = useState(false);\r\n    const [editing, setEditing] = useState(false);\r\n    const [error, setError] = useState(''); // General/Fetch error\r\n    const [updateError, setUpdateError] = useState(''); // Update specific error\r\n    const [validationErrors, setValidationErrors] = useState({});\r\n    const [updateSuccess, setUpdateSuccess] = useState('');\r\n\r\n    // Form state\r\n    const [newName, setNewName] = useState('');\r\n    const [newEmail, setNewEmail] = useState('');\r\n    const [newPassword, setNewPassword] = useState('');\r\n    const [phoneNumber, setPhoneNumber] = useState('');\r\n    const [imageUrl, setImageUrl] = useState('');\r\n    const [profileImage, setProfileImage] = useState('');\r\n\r\n    // --- Initialize Form ---\r\n    const initializeForm = useCallback((userData) => {\r\n        if (!userData) return;\r\n        console.log(\"[initializeForm] Initializing with:\", userData.name, userData.profile_picture_url);\r\n        setNewName(userData.name || '');\r\n        setNewEmail(userData.email || '');\r\n        setPhoneNumber(userData.phone || '');\r\n        const currentImageUrl = userData.profile_picture_url || '';\r\n        setImageUrl(currentImageUrl);\r\n        setProfileImage(currentImageUrl);\r\n        setNewPassword('');\r\n        setValidationErrors({});\r\n        setUpdateError('');\r\n        setUpdateSuccess('');\r\n    }, []);\r\n\r\n    // --- Fetch User ---\r\n    const fetchUser = useCallback(async (force = false) => {\r\n        if (!isLoggedIn) return null;\r\n        if (loading && !force) return user;\r\n\r\n        console.log(`[fetchUser] Attempting fetch... Force: ${force}`);\r\n        if(!force) setLoading(true); // Only set initial loading if not forced\r\n        setError('');\r\n        try {\r\n            const userData = await getUser();\r\n            if (!userData) throw new Error(\"Nem érkeztek felhasználói adatok.\");\r\n            console.log(\"[fetchUser] Data received:\", userData.name, userData.profile_picture_url);\r\n\r\n            // Update states\r\n            setUser(userData);\r\n            contextLogin(userData, localStorage.getItem('token'));\r\n            initializeForm(userData); // Always initialize form after successful fetch\r\n\r\n             if (!force) setLoading(false); // Stop initial loading\r\n            return userData;\r\n\r\n        } catch (err) {\r\n            console.error(\"[fetchUser] Error:\", err);\r\n            setError(err.message || 'Profil betöltési hiba.');\r\n            setUser(null);\r\n            if (err.message.includes('hitelesít') || err.response?.status === 401) {\r\n                 contextLogout(); navigate('/bejelentkezes');\r\n            }\r\n            if (!force) setLoading(false); // Stop initial loading on error\r\n            return null;\r\n        }\r\n    }, [isLoggedIn, loading, user, editing, contextLogin, contextLogout, navigate, initializeForm]); // Add user, editing\r\n\r\n     // --- Initial Load Effect ---\r\n     useEffect(() => {\r\n         if (isLoggedIn && !user && !loading) { // Fetch only if logged in, no user, and not already loading\r\n             fetchUser();\r\n         } else if (isLoggedIn && user && !editing) {\r\n             // If user exists and not editing, ensure form is synced\r\n              initializeForm(user);\r\n         } else if (!isLoggedIn){\r\n              // Handle logged out state if necessary (e.g., redirect)\r\n         }\r\n     }, [isLoggedIn, user, editing, loading, fetchUser, initializeForm]); // Dependencies\r\n\r\n\r\n    // --- Validation ---\r\n    const validateForm = useCallback(() => {\r\n        // ... (validation logic) ...\r\n        const errors = {};\r\n        if (!newName.trim()) errors.name = 'Név megadása kötelező!';\r\n        if (!newEmail.trim()) {\r\n            errors.email = 'Email cím megadása kötelező!';\r\n        } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(newEmail)) {\r\n            errors.email = 'Érvénytelen email cím formátum!';\r\n        }\r\n        if (newPassword && newPassword.length < 6) {\r\n            errors.password = 'Jelszó min. 6 karakter!';\r\n        }\r\n        if (phoneNumber && phoneNumber.trim() && !/^\\+?[0-9\\s-()]{7,}$/.test(phoneNumber)) {\r\n            errors.phoneNumber = 'Érvénytelen telefonszám!';\r\n        }\r\n        const trimmedImageUrl = imageUrl.trim();\r\n        if (trimmedImageUrl && !/^https?:\\/\\/.+\\..+/i.test(trimmedImageUrl)) {\r\n            errors.imageUrl = 'Érvénytelen URL (http(s)://...)!';\r\n        }\r\n        setValidationErrors(errors);\r\n        return Object.keys(errors).length === 0;\r\n    }, [newName, newEmail, newPassword, phoneNumber, imageUrl]);\r\n\r\n    // --- Handle Update (Focus on stopping loading) ---\r\n    const handleEdit = async (e) => {\r\n        e.preventDefault();\r\n        console.log(\"[handleEdit] Submit triggered.\");\r\n        if (!validateForm()) {\r\n            console.log(\"[handleEdit] Validation failed.\");\r\n            return;\r\n        }\r\n\r\n        setUpdateLoading(true); // <<< START Loading\r\n        console.log(\"[handleEdit] updateLoading set to true.\");\r\n        setUpdateError('');\r\n        setUpdateSuccess('');\r\n\r\n        const dataToUpdate = {\r\n            name: newName.trim(),\r\n            email: newEmail.trim(),\r\n            phone: phoneNumber.trim() || null,\r\n            profile_picture_url: imageUrl.trim() || null, // Use DB name\r\n        };\r\n        if (newPassword.trim()) {\r\n            dataToUpdate.password = newPassword.trim();\r\n        }\r\n\r\n        try {\r\n            console.log(\"[handleEdit] Calling updateUser with:\", dataToUpdate);\r\n            await updateUser(dataToUpdate); // Call API\r\n            console.log(\"[handleEdit] updateUser call presumed successful.\");\r\n\r\n            // --- Force Re-fetch ---\r\n            console.log(\"[handleEdit] Forcing user re-fetch...\");\r\n            const freshUserData = await fetchUser(true); // force=true\r\n\r\n            if (freshUserData) {\r\n                console.log(\"[handleEdit] Re-fetch successful.\");\r\n                setEditing(false); // Exit edit mode ONLY after success\r\n                setUpdateSuccess('Adatok sikeresen frissítve!');\r\n                 // Form is initialized by fetchUser -> initializeForm\r\n                setTimeout(() => setUpdateSuccess(''), 4000);\r\n            } else {\r\n                 console.error(\"[handleEdit] Re-fetch FAILED after successful update!\");\r\n                 // Don't exit editing mode, show error\r\n                 setUpdateError(\"Hiba történt az adatok frissítésekor a felületen. Próbáld újra menteni, vagy frissítsd az oldalt.\");\r\n            }\r\n\r\n        } catch (updateOrFetchErr) {\r\n            console.error(\"[handleEdit] Error during update/re-fetch process:\", updateOrFetchErr);\r\n            setUpdateError(updateOrFetchErr.message || 'Hiba történt a mentés során.');\r\n        } finally {\r\n            // --- **KRITIKUS** ---\r\n            console.log(\"[handleEdit] Entering finally block...\");\r\n            setUpdateLoading(false); // <<< STOP Loading GUARANTEED\r\n            console.log(\"[handleEdit] updateLoading set to false.\");\r\n        }\r\n    };\r\n\r\n    // --- Logout ---\r\n    const handleLogout = () => { /* ... */ };\r\n    // --- Cancel Edit ---\r\n    const handleCancelEdit = () => { /* ... (uses initializeForm) ... */ };\r\n\r\n    // --- Render Logic ---\r\n    if (loading) { /* ... Spinner ... */ }\r\n    if (!user) { /* ... Error/Login prompt ... */ }\r\n\r\n    // --- Main Profile Render ---\r\n    return (\r\n        <div className=\"container py-5\">\r\n            <div className=\"profile-card\">\r\n                <h1 className=\"profile-title mb-4\">Profil</h1>\r\n                {/* Messages */}\r\n                {updateSuccess && <div className=\"alert alert-success\">{updateSuccess}</div>}\r\n                {updateError && <div className=\"alert alert-danger\">{updateError}</div>}\r\n                {error && !editing && <div className=\"alert alert-danger\">{error}</div>}\r\n\r\n                <div className=\"profile-content\">\r\n                    {/* Image Section */}\r\n                    <div className=\"profile-image-section\">\r\n                        <img\r\n                            // profileImage state holds the URL for display\r\n                            src={profileImage || placeholderImage} // Use local fallback\r\n                            alt={`${user.name} profilképe`}\r\n                            className=\"profile-image\"\r\n                            key={profileImage} // Force re-render\r\n                            onError={(e) => {\r\n                                console.warn(\"Image onError triggered for src:\", e.target.src);\r\n                                e.target.onerror = null;\r\n                                e.target.src = placeholderImage; // Fallback to local image\r\n                            }}\r\n                        />\r\n                       {/* Image URL Input only shown when editing */}\r\n{editing && (\r\n    <div className=\"mt-3\">\r\n        {/* ... a kép URL input mezője ... */}\r\n    </div>\r\n)}\r\n                    </div>\r\n\r\n                    {/* Details / Form Section */}\r\n                    <h3 className=\"profile-subtitle mb-3\">Felhasználói adatok</h3>\r\n                    {!editing ? (\r\n    // --- Display Mode ---\r\n    <div className=\"profile-details\">\r\n        <p><strong>Név:</strong> {user.name}</p>\r\n        <p><strong>Email:</strong> {user.email}</p>\r\n        <p><strong>Telefonszám:</strong> {user.phone || 'Nincs megadva'}</p>\r\n        <p><strong>Regisztráció:</strong> {user.created_at ? new Date(user.created_at).toLocaleDateString('hu-HU') : 'Ismeretlen'}</p>\r\n        <div className=\"profile-actions mt-4\">\r\n            <button className=\"btn btn-outline-primary\" onClick={() => setEditing(true)} disabled={updateLoading}>Adatok szerkesztése</button>\r\n            <button className=\"btn btn-outline-danger ms-2\" onClick={handleLogout} disabled={updateLoading}>Kilépés</button>\r\n        </div>\r\n    </div>\r\n) : (\r\n    // --- Editing Mode ---\r\n    <form id=\"profileForm\" onSubmit={handleEdit}>\r\n        {/* Name */}\r\n        <div className=\"mb-3\">\r\n            <label htmlFor=\"editName\" className=\"form-label\">Név</label>\r\n            <input type=\"text\" className={`form-control ${validationErrors.name ? 'is-invalid' : ''}`} id=\"editName\" value={newName} onChange={(e) => setNewName(e.target.value)} required disabled={updateLoading} />\r\n            {validationErrors.name && <div className=\"invalid-feedback\">{validationErrors.name}</div>}\r\n        </div>\r\n        {/* Email */}\r\n        <div className=\"mb-3\">\r\n            <label htmlFor=\"editEmail\" className=\"form-label\">Email cím</label>\r\n            <input type=\"email\" className={`form-control ${validationErrors.email ? 'is-invalid' : ''}`} id=\"editEmail\" value={newEmail} onChange={(e) => setNewEmail(e.target.value)} required disabled={updateLoading} />\r\n            {validationErrors.email && <div className=\"invalid-feedback\">{validationErrors.email}</div>}\r\n        </div>\r\n         {/* Phone */}\r\n        <div className=\"mb-3\">\r\n            <label htmlFor=\"editPhoneNumber\" className=\"form-label\">Telefonszám</label>\r\n            <input type=\"tel\" className={`form-control ${validationErrors.phoneNumber ? 'is-invalid' : ''}`} id=\"editPhoneNumber\" value={phoneNumber} onChange={(e) => setPhoneNumber(e.target.value)} placeholder=\"Opcionális\" disabled={updateLoading} />\r\n            {validationErrors.phoneNumber && <div className=\"invalid-feedback\">{validationErrors.phoneNumber}</div>}\r\n        </div>\r\n        {/* Image URL - Helyezd ide a formon belülre */}\r\n        <div className=\"mb-3\">\r\n            <label htmlFor=\"profileImageUrl\" className=\"form-label\">Profilkép URL</label>\r\n            <input type=\"text\" className={`form-control ${validationErrors.imageUrl ? 'is-invalid' : ''}`} id=\"profileImageUrl\" value={imageUrl} onChange={(e) => { setImageUrl(e.target.value); setProfileImage(e.target.value);}} placeholder=\"Kép URL-je (pl. https://...)\" disabled={updateLoading} />\r\n             {validationErrors.imageUrl && <div className=\"invalid-feedback\">{validationErrors.imageUrl}</div>}\r\n        </div>\r\n        {/* Password */}\r\n        <div className=\"mb-3\">\r\n            <label htmlFor=\"editPassword\" className=\"form-label\">Új jelszó</label>\r\n            <input type=\"password\" className={`form-control ${validationErrors.password ? 'is-invalid' : ''}`} id=\"editPassword\" value={newPassword} onChange={(e) => setNewPassword(e.target.value)} placeholder=\"Üresen hagyva nem változik\" disabled={updateLoading} />\r\n            {validationErrors.password && <div className=\"invalid-feedback\">{validationErrors.password}</div>}\r\n        </div>\r\n\r\n        {/* Buttons */}\r\n        <div className=\"profile-actions mt-4\">\r\n            <button type=\"submit\" className=\"btn btn-primary\" disabled={updateLoading}>\r\n                {updateLoading ? <><span className=\"spinner-border spinner-border-sm me-2\"></span>Mentés...</> : 'Mentés'}\r\n            </button>\r\n            <button type=\"button\" className=\"btn btn-outline-secondary ms-2\" onClick={handleCancelEdit} disabled={updateLoading}>\r\n                Mégse\r\n            </button>\r\n        </div>\r\n    </form>\r\n)}\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Profile;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}